<!doctype html><html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Ardupilot Postmortem - Scott O'Brien</title><meta name=HandheldFriendly content="True"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css><link rel=stylesheet type=text/css href=/assets/css/normalize.css><link rel=stylesheet type=text/css href=/assets/css/icons.css><link rel=stylesheet type=text/css href=/assets/css/screen.css><link href="https://fonts.googleapis.com/css?family=Bree+Serif|Lato:100,100i,300,300i,400,400i,700,700i|Source+Code+Pro:300,400,500,700" rel=stylesheet><script src=https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js></script>
<script type=text/javascript src=/assets/bigfoot/dist/bigfoot.js></script>
<link rel=stylesheet type=text/css href=/assets/bigfoot/dist/bigfoot-number.css><script type=text/javascript>$.bigfoot()</script></head><body class=post-template><header class=main-header><div class=main-header-content><h1 class=blog-title><a href=/>Scott O'Brien</a></h1><h2 class=blog-description>Projects, Ramblings and Resources of my (online) life</h2></div><div class=nav><a class=nav- role=presentation href=/page/bucketlist/>The Bucket List</a>
<a class=nav- role=presentation href=/page/about/>About Me</a>
<a class=nav- role=presentation href=/recipes/>Recipes</a>
<a class=nav- role=presentation href=/flying/>Flying</a></div></header><main class=content role=main><article class=post><header class=post-header><img src=/post/ardupilot-postmortem/crash.jpg></img><h2 class=post-title>Ardupilot Postmortem</h2><section class=post-meta><time class=post-date>November 27, 2022</time></section></header><section class=post-content><p><strong>A big thanks to those who helped from the <a href=https://discuss.ardupilot.org/t/crash-postmortem-why-the-pitch-down/93666/13>Ardupilot Forum</a></strong></p><p>Last week, I took a few extra days off from work to give myself a nice long break over Thanksgiving week.</p><p>I spent a lot of time finishing an RC plane we had some replacement parts for. This one was going to be autonomous. I spent a few days soldering the flight controller and electronics, gluing the plane together, measuring and trimming everything perfectly. It was perfectly balanced, perfectly weighted. We finally took it out for its maiden flight today, Sunday November 27. Sadly, this story ends in pieces.</p><p>This post is a postmortem of the incident to make sense of what happened. I was flying using Ardupilot and had an SD card in recording the data. Although I can&rsquo;t be certain, I&rsquo;m pretty sure we can use this data to root cause the issues.</p><h3 id=plane-hardware>Plane Hardware</h3><ul><li><strong>Plane</strong>: <a href=https://hobbyking.com/en_us/h-king-bixler-3-glider-1550-pnf.html>Bixler 3</a></li><li><strong>Flight Controller</strong>: <a href=https://ardupilot.org/copter/docs/common-holybro-kakutef7aio.html>Holybro Kakute F7</a></li><li><strong>GPS, Compass</strong>: <a href=https://ardupilot.org/copter/docs/common-beitian-gps.html>Beitian BN-880</a></li><li><strong>Ardupilot</strong>: Arduplane V4.3.1</li></ul><h3 id=tools--files>Tools & Files</h3><ul><li><a href=https://ardupilot.org/dev/docs/common-uavlogviewer.html>UAV Logviewer</a></li><li>Ardupilot <strong><a href=/post/ardupilot-postmortem/log.bin>LOG FILE</a></strong></li></ul><h3 id=theories--investigation>Theories & Investigation</h3><p>The flight controller has a BMP280 barometer to measure the altitude quickly, and a ICM20689 IMU for acceleration and gyro. There is also a slower-updating GPS, so between these instruments, I expect fairly accurate altitude and position readings. The plane behaved erratically twice in the short two-minute flight. After combing through the available data, I suspect two failures during this flight. What follows is a timeline of the events of the flight and notes on each incident.</p><h3 id=events-in-flight>Events in Flight</h3><h4 id=1-bad-altitude-readings-pre-launch>1. Bad Altitude Readings Pre-Launch</h4><p>The first noteworthy item is that the altitude readings from the barometer and accelerometer are bogus. I seem to be getting more realistic readings from the GPS. Going forward, any screenshots will be from the GPS altitude.</p><video width=100% loop=true controls autoplay muted>
<source src=/post/ardupilot-postmortem/altitude.mp4></video><p><img src=/post/ardupilot-postmortem/Altitude.jpg alt=altitude></p><p>The altitude readings are super interesting here. You can tell even before I launch the plane, the GPS altitude readings are between -13m and 0m. Not sure what this altitude is (above sea level? Above ground level?? Either way, this flight took place very nearly at sea level.)</p><p>More concerning, the barometer altitude is between -10 and -70m in the ~1 minute before launch on the ground. The calculated AHRS (Attitude Heading Reference System) altitude at somewhat similar, -9 and -80 ðŸ«¤</p><h4 id=root-cause>ROOT CAUSE</h4><p>As mentioned, the Ardupilot software uses a combination of an accelerometer, GPS, and barometer to calculate the current altitude. In this instance, the hardware was not faulty, but badly installed.</p><p>On this flight controller, the barometer is on the bottom of the board. It has a little tiny hole in it to allow pressure sensing. In my ðŸ¤¡&rsquo;y install, this is covered by hot glue and velcro.</p><p>While this didn&rsquo;t cause a crash, it shows that I didn&rsquo;t ground test the altitude, and any attempts at keeping altitude in autopilot mode may have been dangerous.
<script src=/shortcode-gallery/swipebox/js/jquery.swipebox.min.js></script>
<link rel=stylesheet href=/shortcode-gallery/swipebox/css/swipebox.min.css><script src=/shortcode-gallery/justified_gallery/jquery.justifiedGallery.min.js></script>
<link rel=stylesheet href=/shortcode-gallery/justified_gallery/justifiedGallery.min.css><style></style><div id=gallery-9e476f65a0eaaa9358dee643e3be0810-0-wrapper class=gallery-wrapper><div id=gallery-9e476f65a0eaaa9358dee643e3be0810-0 class=justified-gallery><div><a href=/post/ardupilot-postmortem/baro/glue.jpg class=galleryImg><img width=108 height=150 src=/post/ardupilot-postmortem/baro/glue_hu42a96ab0b11ffe010cf8351aa03f9a9e_124639_300x150_fit_q85_lanczos.jpg></a></div><div><a href=/post/ardupilot-postmortem/baro/baro.jpg class=galleryImg><img width=187 height=150 src=/post/ardupilot-postmortem/baro/baro_hueca8901abdc607b72704a94005dcecc3_99418_300x150_fit_q85_lanczos.jpg></a></div><div><a href=/post/ardupilot-postmortem/baro/baro_debugging.jpg class=galleryImg><img width=300 height=91 src=/post/ardupilot-postmortem/baro/baro_debugging_hu78184c91f8c67ac0558f5686a0e4f645_173629_300x150_fit_q85_lanczos.jpg></a></div></div></div><script>jQuery||alert("jquery is not loaded"),$(document).ready(()=>{const e=$("#gallery-9e476f65a0eaaa9358dee643e3be0810-0");let t=null;e.on("jg.complete",()=>{t=$(".galleryImg").swipebox(jQuery.extend({},{}))}),e.justifiedGallery({rowHeight:"200",margins:"5",border:0,waitThumbnailsLoad:!1,lastRow:"justify",captions:!1})})</script></p><h4 id=2-launch>2. Launch</h4><p>The maiden launch itself in manual mode was nominal. You can hear me saying &ldquo;Good luck little plane&rdquo;. It needed more than luck it seems!</p><iframe height=315 style=width:100%;max-width:560px;display:block;margin:auto src=https://www.youtube.com/embed/D03_c0LWJhM title="YouTube video player" frameborder=0 allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe><h4 id=3-fly-by-wire-test>3. Fly-By-Wire Test</h4><p>At ~1 minute 22 seconds into the flight, I turned the flight mode from manual to <a href=https://ardupilot.org/plane/docs/fbwa-mode.html>Fly by wire A</a>, which should have had the effect of assisting the plane in straight line. Looking at the radio stick input, I did not change the heading, but the autopilot sent this into a steep dive at this time. A near miss where we avoided a crash here.</p><p><img src=/post/ardupilot-postmortem/fbw.jpg alt=FBW></p><h5 id=reversed-elevator>Reversed Elevator</h5><p><img src=/post/ardupilot-postmortem/Nosedive1.jpg alt=nosedive>
12:24 is interesting here. If we look at the time we engage the autopilot, we can see the pitch heading down into the ground, before our roll even begins to change. It ends up to a point where it&rsquo;s almost completely nose down before we save it by switching to manual flight mode.</p><h5 id=root-cause-1>Root Cause</h5><p>What&rsquo;s interesting is that the pitch continues to fall, and the AETR elevator gets more and more positive. Is it possible that we&rsquo;re trying to correct the nose down and instead making it worse? Here I did NOT check how the autopilot responds on the ground, and I instead tested in manual mode, and adjusted the Servo Output functions to work. I should have instead checked this in combination with the Radio Calibration reverse settings</p><p><img src=/post/ardupilot-postmortem/radio.jpg alt=controllers>
<img src=/post/ardupilot-postmortem/servo.jpg alt=servos></p><h3 id=4-crash-elevator-failure>4. Crash (elevator failure?)</h3><p>This event makes me believe that I had an elevator failure during the flight. In a panic I &ldquo;checked&rdquo; my autopilot settings, and accidentally turned it on.</p><p><strong>Events:</strong></p><ul><li>Nominal flight approaching turn</li><li>Banks left to enter turn</li><li>Starts pitching down, control toggles are pulling back on the elevator, manual flight mode still engaged</li><li>Plane is not responsive and is still pitching down</li><li>After loosing much altitude, in a panic, RTL is engaged</li><li>Plane starts pitching nose down further once RTL is engaged (reversed elevator theory?) causing the epic crash with almost full speed, full nose down</li></ul><video width=100% controls autoplay muted>
<source src=/post/ardupilot-postmortem/crash.mp4></video><p>Upon inspection, the suspected failed elevator servo is the one shown in black here. When moving the control horns without power, I noticed that it slipped. It&rsquo;s possible it could have slipped in flight causing the loss of the ability to pitch up. It&rsquo;s also possible that the 915mhz SIK radio I was flying with for telemetry interfered with the servo (they do twitch then they&rsquo;re close, but I had thought I had moved this far enough away). I guess we&rsquo;ll never truly know!</p><p><img src=/post/ardupilot-postmortem/crashed_servos.jpg alt=controllers>
<video width=100% controls autoplay loop muted>
<source src=/post/ardupilot-postmortem/bad_servo.mp4></video></p><h3 id=lessons>Lessons</h3><ul><li>Don&rsquo;t fly with so much throttle. Mistakes happen a <em>lot</em> faster than it could otherwise happen</li><li>Test the FBWA modes on the ground. Ensure that the elevator, ailerons and rudder is behaving as expected in relationship to pitch, roll movements.</li><li>Make sure you setup BOTH the reverse setting on the controller input, and servo output.</li><li>Be sure to glue in everything! I&rsquo;m not convinced a servo could have come loose during this flight.</li></ul></section><footer class=post-footer><section class="tags post-meta">Tagged
<a href=https://www.scottyob.com/tags/rc/>rc</a>
<a href=https://www.scottyob.com/tags/ardupilot/>ardupilot</a></section></footer></article></main><footer class=site-footer><section class=rss><a class="subscribe-button icon-feed" href=/index.xml></a></section><section class=copyright>&copy; 2022 Scott O'Brien</section><section class=poweredby><a href=https://github.com/nirocfz/arabica>Arabica</a> theme by Sean Lunsford. Published with <a href=https://gohugo.io>Hugo</a>.</section></footer></body></html>